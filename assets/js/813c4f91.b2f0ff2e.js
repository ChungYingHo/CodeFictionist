"use strict";(self.webpackChunkcode_fictionist=self.webpackChunkcode_fictionist||[]).push([[1281],{33730:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>m,frontMatter:()=>a,metadata:()=>s,toc:()=>d});var r=t(85893),o=t(11151);const a={title:"\u5b98\u65b9\u6559\u5b78 - \u932f\u8aa4\u8655\u7406",tags:["react","next","error","not-found"]},i=void 0,s={id:"tech_articles/framework/React/next-error-handle",title:"\u5b98\u65b9\u6559\u5b78 - \u932f\u8aa4\u8655\u7406",description:"try/catch",source:"@site/docs/tech_articles/03-framework/01-React/10-next-error-handle.mdx",sourceDirName:"tech_articles/03-framework/01-React",slug:"/tech_articles/framework/React/next-error-handle",permalink:"/docs/tech_articles/framework/React/next-error-handle",draft:!1,unlisted:!1,tags:[{inline:!0,label:"react",permalink:"/docs/tags/react"},{inline:!0,label:"next",permalink:"/docs/tags/next"},{inline:!0,label:"error",permalink:"/docs/tags/error"},{inline:!0,label:"not-found",permalink:"/docs/tags/not-found"}],version:"current",sidebarPosition:10,frontMatter:{title:"\u5b98\u65b9\u6559\u5b78 - \u932f\u8aa4\u8655\u7406",tags:["react","next","error","not-found"]},sidebar:"programSidebar",previous:{title:"\u5b98\u65b9\u6559\u5b78 - \u8cc7\u6599\u8b8a\u66f4",permalink:"/docs/tech_articles/framework/React/next-mutating-data"},next:{title:"Vue3 - \u5c08\u6848\u5efa\u7acb\u8207\u97ff\u61c9\u5f0f\u8cc7\u6599",permalink:"/docs/tech_articles/framework/Vue/reactive"}},c={},d=[{value:"try/catch",id:"trycatch",level:2},{value:"\u4f7f\u7528 <strong>error.tsx</strong> \u4f86\u7d71\u4e00\u8655\u7406\u932f\u8aa4",id:"\u4f7f\u7528-errortsx-\u4f86\u7d71\u4e00\u8655\u7406\u932f\u8aa4",level:2},{value:"404 error",id:"404-error",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h2,{id:"trycatch",children:"try/catch"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:"title='/app/lib/actions.ts'",children:"export async function createInvoice(formData: FormData) {\n  const { customerId, amount, status } = CreateInvoice.parse({\n    customerId: formData.get('customerId'),\n    amount: formData.get('amount'),\n    status: formData.get('status'),\n  });\n \n  const amountInCents = amount * 100;\n  const date = new Date().toISOString().split('T')[0];\n \n  try {\n    await sql`\n      INSERT INTO invoices (customer_id, amount, status, date)\n      VALUES (${customerId}, ${amountInCents}, ${status}, ${date})\n    `;\n  } catch (error) {\n    return {\n      message: 'Database Error: Failed to Create Invoice.',\n    };\n  }\n \n  revalidatePath('/dashboard/invoices');\n  redirect('/dashboard/invoices');\n}\n\nexport async function updateInvoice(id: string, formData: FormData) {\n  const { customerId, amount, status } = UpdateInvoice.parse({\n    customerId: formData.get('customerId'),\n    amount: formData.get('amount'),\n    status: formData.get('status'),\n  });\n \n  const amountInCents = amount * 100;\n \n  try {\n    await sql`\n        UPDATE invoices\n        SET customer_id = ${customerId}, amount = ${amountInCents}, status = ${status}\n        WHERE id = ${id}\n      `;\n  } catch (error) {\n    return { message: 'Database Error: Failed to Update Invoice.' };\n  }\n \n  revalidatePath('/dashboard/invoices');\n  redirect('/dashboard/invoices');\n}\n\nexport async function deleteInvoice(id: string) {\n  try {\n    await sql`DELETE FROM invoices WHERE id = ${id}`;\n    revalidatePath('/dashboard/invoices');\n    return { message: 'Deleted Invoice.' };\n  } catch (error) {\n    return { message: 'Database Error: Failed to Delete Invoice.' };\n  }\n}\n"})}),"\n",(0,r.jsxs)(n.h2,{id:"\u4f7f\u7528-errortsx-\u4f86\u7d71\u4e00\u8655\u7406\u932f\u8aa4",children:["\u4f7f\u7528 ",(0,r.jsx)(n.strong,{children:"error.tsx"})," \u4f86\u7d71\u4e00\u8655\u7406\u932f\u8aa4"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",metastring:"title='/dashboard/invoices/error.tsx'",children:'\'use client\';\n \nimport { useEffect } from \'react\';\n \nexport default function Error({\n  error,\n  reset,\n}: {\n  error: Error & { digest?: string };\n  reset: () => void;\n}) {\n  useEffect(() => {\n    // Optionally log the error to an error reporting service\n    console.error(error);\n  }, [error]);\n \n  return (\n    <main className="flex h-full flex-col items-center justify-center">\n      <h2 className="text-center">Something went wrong!</h2>\n      <button\n        className="mt-4 rounded-md bg-blue-500 px-4 py-2 text-sm text-white transition-colors hover:bg-blue-400"\n        onClick={\n          // Attempt to recover by trying to re-render the invoices route\n          () => reset()\n        }\n      >\n        Try again\n      </button>\n    </main>\n  );\n}\n'})}),"\n",(0,r.jsxs)(n.admonition,{type:"info",children:[(0,r.jsx)(n.p,{children:"\u6a21\u64ec\u932f\u8aa4\u767c\u751f\uff1a"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",metastring:"title='/app/lib/actions.ts'",children:"export async function deleteInvoice(id: string) {\n    // highlight-next-line\n  throw new Error('Failed to Delete Invoice');\n \n  // Unreachable code block\n  try {\n    await sql`DELETE FROM invoices WHERE id = ${id}`;\n    revalidatePath('/dashboard/invoices');\n    return { message: 'Deleted Invoice' };\n  } catch (error) {\n    return { message: 'Database Error: Failed to Delete Invoice' };\n  }\n}\n"})})]}),"\n",(0,r.jsx)(n.h2,{id:"404-error",children:"404 error"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\u5148\u8abf\u6574 ",(0,r.jsx)(n.strong,{children:"/dashboard/invoices/[id]/edit/page.tsx"})]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",metastring:"title='/dashboard/invoices/[id]/edit/page.tsx'",children:"import { fetchInvoiceById, fetchCustomers } from '@/app/lib/data';\nimport { updateInvoice } from '@/app/lib/actions';\n// highlight-next-line\nimport { notFound } from 'next/navigation';\n \nexport default async function Page({ params }: { params: { id: string } }) {\n  const id = params.id;\n  const [invoice, customers] = await Promise.all([\n    fetchInvoiceById(id),\n    fetchCustomers(),\n  ]);\n \n//  highlight-start\n  if (!invoice) {\n    notFound();\n  }\n// highlight-end\n  // ...\n}\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:"\u5efa\u7acb\u4ee5\u4e0b\u8cc7\u6599\u593e\u7d50\u69cb\uff1a"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",children:"---| invoices\n------| [id]\n---------| edit\n------------| page.tsx\n------------| not-found.tsx\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-tsx",metastring:"title='/dashboard/invoices/[id]/edit/not-found.tsx'",children:'import Link from \'next/link\';\nimport { FaceFrownIcon } from \'@heroicons/react/24/outline\';\n \nexport default function NotFound() {\n  return (\n    <main className="flex h-full flex-col items-center justify-center gap-2">\n      <FaceFrownIcon className="w-10 text-gray-400" />\n      <h2 className="text-xl font-semibold">404 Not Found</h2>\n      <p>Could not find the requested invoice.</p>\n      <Link\n        href="/dashboard/invoices"\n        className="mt-4 rounded-md bg-blue-500 px-4 py-2 text-sm text-white transition-colors hover:bg-blue-400"\n      >\n        Go Back\n      </Link>\n    </main>\n  );\n}\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["\u53ef\u4ee5\u4f7f\u7528 ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"http://localhost:3002/dashboard/invoices/2e94d1ed-d220-449f-9f11-f0bbceed9645/edit",children:"http://localhost:3002/dashboard/invoices/2e94d1ed-d220-449f-9f11-f0bbceed9645/edit"})})," \u9019\u652f\u7db2\u5740\u505a\u6e2c\u8a66\uff0c\u4f46\u6ce8\u610f\u81ea\u5df1\u8a2d\u5b9a\u7684 port\u3002"]})})]})}function m(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>s,a:()=>i});var r=t(67294);const o={},a=r.createContext(o);function i(e){const n=r.useContext(a);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);