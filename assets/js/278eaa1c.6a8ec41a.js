"use strict";(self.webpackChunkcode_fictionist=self.webpackChunkcode_fictionist||[]).push([[727],{63938:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>s,metadata:()=>c,toc:()=>o});var t=a(85893),r=a(11151);const s={title:"\u5b98\u65b9\u6559\u5b78 - \u641c\u5c0b\u8207\u5206\u9801",tags:["react","next","search","pagination"]},i=void 0,c={id:"tech_articles/framework/React/Next/next-search",title:"\u5b98\u65b9\u6559\u5b78 - \u641c\u5c0b\u8207\u5206\u9801",description:"\u8d77\u59cb\u624b\u7e8c",source:"@site/docs/tech_articles/03-framework/01-React/Next/06-next-search.mdx",sourceDirName:"tech_articles/03-framework/01-React/Next",slug:"/tech_articles/framework/React/Next/next-search",permalink:"/docs/tech_articles/framework/React/Next/next-search",draft:!1,unlisted:!1,tags:[{inline:!0,label:"react",permalink:"/docs/tags/react"},{inline:!0,label:"next",permalink:"/docs/tags/next"},{inline:!0,label:"search",permalink:"/docs/tags/search"},{inline:!0,label:"pagination",permalink:"/docs/tags/pagination"}],version:"current",sidebarPosition:6,frontMatter:{title:"\u5b98\u65b9\u6559\u5b78 - \u641c\u5c0b\u8207\u5206\u9801",tags:["react","next","search","pagination"]},sidebar:"programSidebar",previous:{title:"\u5b98\u65b9\u6559\u5b78 - \u975c\u614b\u8207\u52d5\u614b\u6e32\u67d3",permalink:"/docs/tech_articles/framework/React/Next/next-render"},next:{title:"\u5b98\u65b9\u6559\u5b78 - \u8cc7\u6599\u8b8a\u66f4",permalink:"/docs/tech_articles/framework/React/Next/next-mutating-data"}},l={},o=[{value:"\u8d77\u59cb\u624b\u7e8c",id:"\u8d77\u59cb\u624b\u7e8c",level:2},{value:"\u65b0\u589e\u641c\u5c0b\u529f\u80fd",id:"\u65b0\u589e\u641c\u5c0b\u529f\u80fd",level:2},{value:"Step1- \u6355\u7372\u4f7f\u7528\u8005\u7684\u8f38\u5165\u5167\u5bb9",id:"step1--\u6355\u7372\u4f7f\u7528\u8005\u7684\u8f38\u5165\u5167\u5bb9",level:3},{value:"\u96a8\u8457\u641c\u5c0b\u53c3\u6578\u66f4\u65b0\u8def\u7531",id:"\u96a8\u8457\u641c\u5c0b\u53c3\u6578\u66f4\u65b0\u8def\u7531",level:3},{value:"\u8b93\u8f38\u5165\u6b04\u4f4d\u7684\u503c\u8ddf\u8def\u7531\u4fdd\u6301\u540c\u6b65",id:"\u8b93\u8f38\u5165\u6b04\u4f4d\u7684\u503c\u8ddf\u8def\u7531\u4fdd\u6301\u540c\u6b65",level:3},{value:"\u900f\u904e\u641c\u5c0b\u53c3\u6578\u66f4\u65b0\u8868\u683c\u6e32\u67d3",id:"\u900f\u904e\u641c\u5c0b\u53c3\u6578\u66f4\u65b0\u8868\u683c\u6e32\u67d3",level:3},{value:"Debouncing",id:"debouncing",level:3},{value:"\u65b0\u589e\u5206\u9801 (pagination)",id:"\u65b0\u589e\u5206\u9801-pagination",level:2}];function h(e){const n={br:"br",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"\u8d77\u59cb\u624b\u7e8c",children:"\u8d77\u59cb\u624b\u7e8c"}),"\n",(0,t.jsxs)(n.p,{children:["\u5148\u5728 ",(0,t.jsx)(n.strong,{children:"/dashboard/invoices/page.tsx"})," \u6dfb\u52a0\u4e0b\u5217\u5167\u5bb9\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title='/dashboard/invoices/page.tsx'",children:"import Pagination from '@/app/ui/invoices/pagination';\nimport Search from '@/app/ui/search';\nimport Table from '@/app/ui/invoices/table';\nimport { CreateInvoice } from '@/app/ui/invoices/buttons';\nimport { lusitana } from '@/app/ui/fonts';\nimport { InvoicesTableSkeleton } from '@/app/ui/skeletons';\nimport { Suspense } from 'react';\n \nexport default async function Page() {\n  return (\n    <div className=\"w-full\">\n      <div className=\"flex w-full items-center justify-between\">\n        <h1 className={`${lusitana.className} text-2xl`}>Invoices</h1>\n      </div>\n      <div className=\"mt-4 flex items-center justify-between gap-2 md:mt-8\">\n        <Search placeholder=\"Search invoices...\" />\n        <CreateInvoice />\n      </div>\n      {/*  <Suspense key={query + currentPage} fallback={<InvoicesTableSkeleton />}>\n        <Table query={query} currentPage={currentPage} />\n      </Suspense> */}\n      <div className=\"mt-5 flex w-full justify-center\">\n        {/* <Pagination totalPages={totalPages} /> */}\n      </div>\n    </div>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u65b0\u589e\u641c\u5c0b\u529f\u80fd",children:"\u65b0\u589e\u641c\u5c0b\u529f\u80fd"}),"\n",(0,t.jsx)(n.p,{children:"\u4e3b\u8981\u6703\u9700\u8981\u7528\u5230\u4e09\u500b hook\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"useSearchParams"}),"\uff1a\u5141\u8a31\u8a2a\u554f\u7576\u524d URL \u7684\u53c3\u6578\u3002",(0,t.jsx)(n.strong,{children:"/dashboard/invoices?page=1&query=pending"})," \u7684\u641c\u7d22\u53c3\u6578\u770b\u8d77\u4f86\u6703\u662f\u9019\u6a23\uff1a",(0,t.jsx)(n.code,{children:"{page: '1', query: 'pending'}"}),"\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"usePathname"})," - \u5141\u8a31\u8b80\u53d6\u7576\u524d URL \u7684\u8def\u5f91\u540d\u3002\u4f8b\u5982\uff0c",(0,t.jsx)(n.strong,{children:"/dashboard/invoices"}),"\uff0c",(0,t.jsx)(n.code,{children:"usePathname"})," \u6703\u8fd4\u56de ",(0,t.jsx)(n.strong,{children:"/dashboard/invoices"}),"\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"useRouter"})," - \u5141\u8a31\u5728\u5ba2\u6236\u7aef\u7d44\u4ef6\u5167\u7a0b\u5f0f\u5316\u5730\u5c0e\u822a\u5230\u4e0d\u540c\u8def\u5f91\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"step1--\u6355\u7372\u4f7f\u7528\u8005\u7684\u8f38\u5165\u5167\u5bb9",children:"Step1- \u6355\u7372\u4f7f\u7528\u8005\u7684\u8f38\u5165\u5167\u5bb9"}),"\n",(0,t.jsxs)(n.p,{children:["\u5728 ",(0,t.jsx)(n.strong,{children:"/app/ui/search.tsx"})," \u9019\u500b\u5143\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u89c0\u5bdf\u5230\u5143\u4ef6\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"'use client'"})," \u5b9a\u7fa9\u70ba\u4e00\u500b client component\uff0c\u56e0\u70ba\u53ea\u6709 client component \u624d\u53ef\u4ee5\u6dfb\u52a0\u4e8b\u4ef6\u76e3\u807d\u5668\u8207\u4f7f\u7528 hook\u3002",(0,t.jsx)(n.br,{}),"\n","\u63a5\u4e0b\u4f86\u5c31\u662f\u4fee\u6539 ",(0,t.jsx)(n.code,{children:"<Search>"})," \u9019\u500b\u5143\u4ef6\uff1a"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:'// highlight-next-line\n\'use client\';\n \nimport { MagnifyingGlassIcon } from \'@heroicons/react/24/outline\';\n \nexport default function Search({ placeholder }: { placeholder: string }) {\n  // highlight-start\n  function handleSearch(term: string) {\n    console.log(term);\n  }\n  // highlight-end\n \n  return (\n    <div className="relative flex flex-1 flex-shrink-0">\n      <label htmlFor="search" className="sr-only">\n        Search\n      </label>\n      <input\n        className="peer block w-full rounded-md border border-gray-200 py-[9px] pl-10 text-sm outline-2 placeholder:text-gray-500"\n        placeholder={placeholder}\n        {/* highlight-start */}\n        onChange={(e) => {\n          handleSearch(e.target.value);\n        }}\n        {/* highlight-end */}\n      />\n      <MagnifyingGlassIcon className="absolute left-3 top-1/2 h-[18px] w-[18px] -translate-y-1/2 text-gray-500 peer-focus:text-gray-900" />\n    </div>\n  );\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:"\u9019\u6a23\u5373\u53ef\u518d dev tool \u4e2d\u770b\u5230\u5728\u8f38\u5165\u6846\u8f38\u5165\u7684\u5167\u5bb9\u3002"}),"\n",(0,t.jsx)(n.h3,{id:"\u96a8\u8457\u641c\u5c0b\u53c3\u6578\u66f4\u65b0\u8def\u7531",children:"\u96a8\u8457\u641c\u5c0b\u53c3\u6578\u66f4\u65b0\u8def\u7531"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"useSearchParams"})," \u6355\u7372\u641c\u5c0b\u53c3\u6578\u3002"]}),"\n",(0,t.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"useRouter"})," \u8ddf ",(0,t.jsx)(n.code,{children:"usePathname"})," \u4f86\u66f4\u65b0 URL\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title='/app/ui/search.tsx'",children:"'use client';\n \nimport { MagnifyingGlassIcon } from '@heroicons/react/24/outline';\n// highlight-next-line\nimport { useSearchParams, usePathname, useRouter } from 'next/navigation';\n \nexport default function Search() {\n  const searchParams = useSearchParams();\n  const pathname = usePathname();\n  const { replace } = useRouter();\n \n  function handleSearch(term: string) {\n    const params = new URLSearchParams(searchParams);\n    if (term) {\n      params.set('query', term);\n    } else {\n      params.delete('query');\n    }\n    replace(`${pathname}?${params.toString()}`);\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u8b93\u8f38\u5165\u6b04\u4f4d\u7684\u503c\u8ddf\u8def\u7531\u4fdd\u6301\u540c\u6b65",children:"\u8b93\u8f38\u5165\u6b04\u4f4d\u7684\u503c\u8ddf\u8def\u7531\u4fdd\u6301\u540c\u6b65"}),"\n",(0,t.jsx)(n.p,{children:"\u5373\u7576\u628a\u5e36\u641c\u5c0b\u53c3\u6578\u7684 URL \u7d66\u5176\u4ed6\u4eba\u6642\uff0c\u5176\u4ed6\u4eba\u9032\u5230\u9801\u9762\u4ecd\u7136\u53ef\u4ee5\u5728\u8f38\u5165\u6b04\u4f4d\u4e0a\u770b\u5230\u8a72\u95dc\u9375\u5b57\uff0c\u6240\u4ee5\u91cd\u9ede\u5c31\u662f\u628a\u641c\u5c0b\u53c3\u6578\u8a2d\u70ba\u8f38\u5165\u6b04\u4f4d\u7684\u9810\u8a2d\u503c\u5373\u53ef\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",children:"<input\n  className=\"peer block w-full rounded-md border border-gray-200 py-[9px] pl-10 text-sm outline-2 placeholder:text-gray-500\"\n  placeholder={placeholder}\n  onChange={(e) => {\n    handleSearch(e.target.value);\n  }}\n  {/* highlight-next-line */}\n  defaultValue={searchParams.get('query')?.toString()}\n/>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u900f\u904e\u641c\u5c0b\u53c3\u6578\u66f4\u65b0\u8868\u683c\u6e32\u67d3",children:"\u900f\u904e\u641c\u5c0b\u53c3\u6578\u66f4\u65b0\u8868\u683c\u6e32\u67d3"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title='/app/dashboard/invoices/page.tsx'",children:"import Pagination from '@/app/ui/invoices/pagination';\nimport Search from '@/app/ui/search';\nimport Table from '@/app/ui/invoices/table';\nimport { CreateInvoice } from '@/app/ui/invoices/buttons';\nimport { lusitana } from '@/app/ui/fonts';\nimport { Suspense } from 'react';\nimport { InvoicesTableSkeleton } from '@/app/ui/skeletons';\n//  highlight-start\nexport default async function Page({\n  searchParams,\n}: {\n  searchParams?: {\n    query?: string;\n    page?: string;\n  };\n}) {\n  const query = searchParams?.query || '';\n  const currentPage = Number(searchParams?.page) || 1;\n// highlight-end\n  return (\n    <div className=\"w-full\">\n      <div className=\"flex w-full items-center justify-between\">\n        <h1 className={`${lusitana.className} text-2xl`}>Invoices</h1>\n      </div>\n      <div className=\"mt-4 flex items-center justify-between gap-2 md:mt-8\">\n        <Search placeholder=\"Search invoices...\" />\n        <CreateInvoice />\n      </div>\n      {/* highlight-styart */}\n      <Suspense key={query + currentPage} fallback={<InvoicesTableSkeleton />}>\n        <Table query={query} currentPage={currentPage} />\n      </Suspense>\n      {/* highlight-end */}\n      <div className=\"mt-5 flex w-full justify-center\">\n        {/* <Pagination totalPages={totalPages} /> */}\n      </div>\n    </div>\n  );\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"debouncing",children:"Debouncing"}),"\n",(0,t.jsxs)(n.p,{children:["\u539f\u5148\u7684\u67e5\u8a62\u529f\u80fd\u662f\u96a8\u8457\u5728\u8f38\u5165\u6846\u8f38\u5165\u4e00\u500b\u5b57\u7b26\u5c31\u50cf\u8cc7\u6599\u5eab\u67e5\u8a62\u4e00\u6b21\uff0c\u9019\u5728\u5927\u578b\u5c08\u6848\u4e2d\u6703\u9020\u6210\u6548\u80fd\u7684\u4e0b\u964d\uff0c\u800c debouncing \u5c31\u662f\u7528\u4f86\u9650\u5236\u9019\u500b\u529f\u80fd\u7684\u89f8\u767c\u983b\u7387\u3002",(0,t.jsx)(n.br,{}),"\n","\u4ee5\u5b98\u65b9\u4f8b\u5b50\uff0c\u5c31\u662f\u5728 300ms \u5f8c\u624d\u81ea\u52d5\u89f8\u767c\u641c\u5c0b\u3002"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5148\u5b89\u88dd ",(0,t.jsx)(n.strong,{children:"use-debounce"}),"\uff1a"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:"npm i use-debounce\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"useDebouncedCallback"})," \u4f86\u88fd\u4f5c debouncing"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title='/app/ui/search.tsx'",children:"// ...\nimport { useDebouncedCallback } from 'use-debounce';\n \n// Inside the Search Component...\nconst handleSearch = useDebouncedCallback((term) => {\n  console.log(`Searching... ${term}`);\n \n  const params = new URLSearchParams(searchParams);\n  if (term) {\n    params.set('query', term);\n  } else {\n    params.delete('query');\n  }\n  replace(`${pathname}?${params.toString()}`);\n}, 300);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u65b0\u589e\u5206\u9801-pagination",children:"\u65b0\u589e\u5206\u9801 (pagination)"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\u56e0\u70ba ",(0,t.jsx)(n.code,{children:"<Pagination/>"})," \u662f client component\uff0c\u5728\u88e1\u9762\u505a\u8cc7\u6599\u7372\u53d6\u5176\u5be6\u5bb9\u6613\u6d29\u6f0f\u8cc7\u8a0a\uff0c\u6545\u6bd4\u8f03\u597d\u7684\u505a\u6cd5\u662f\u5728 server component \u5148\u6293\u8cc7\u6599\u518d props \u7d66\u5b50\u5143\u4ef6\u3002"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title='/app/dashboard/invoices/page.tsx'",children:'// ...\n// highlight-next-line\nimport { fetchInvoicesPages } from \'@/app/lib/data\';\n \nexport default async function Page({\n  searchParams,\n}: {\n  searchParams?: {\n    query?: string,\n    page?: string,\n  },\n}) {\n  const query = searchParams?.query || \'\';\n  const currentPage = Number(searchParams?.page) || 1;\n \n // highlight-next-line\n  const totalPages = await fetchInvoicesPages(query);\n \n  return (\n    <div className="w-full">\n      <div className="flex w-full items-center justify-between">\n        <h1 className={`${lusitana.className} text-2xl`}>Invoices</h1>\n      </div>\n      <div className="mt-4 flex items-center justify-between gap-2 md:mt-8">\n        <Search placeholder="Search invoices..." />\n        <CreateInvoice />\n      </div>\n      <Suspense key={query + currentPage} fallback={<InvoicesTableSkeleton />}>\n        <Table query={query} currentPage={currentPage} />\n      </Suspense>\n      <div className="mt-5 flex w-full justify-center">\n        {/* highlight-next-line */}\n        <Pagination totalPages={totalPages} />\n      </div>\n    </div>\n  );\n}\n'})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["\u5230 ",(0,t.jsx)(n.code,{children:"<Pagination/>"})," \u4e2d\u5f15\u7528 ",(0,t.jsx)(n.code,{children:"usePathname"})," \u8ddf ",(0,t.jsx)(n.code,{children:"useSearchParams"}),"\uff0c\u9019\u662f\u7528\u4f86\u53d6\u5f97\u641c\u5c0b\u53c3\u6578\u548c\u73fe\u6b63\u700f\u89bd\u7684\u9801\u9762\u8def\u7531\uff1a"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title='/app/ui/invoices/pagination.tsx'",children:"'use client';\n \nimport { ArrowLeftIcon, ArrowRightIcon } from '@heroicons/react/24/outline';\nimport clsx from 'clsx';\nimport Link from 'next/link';\nimport { generatePagination } from '@/app/lib/utils';\n// highlight-next-line\nimport { usePathname, useSearchParams } from 'next/navigation';\n \nexport default function Pagination({ totalPages }: { totalPages: number }) {\n  // highlight-start\n  const pathname = usePathname();\n  const searchParams = useSearchParams();\n  const currentPage = Number(searchParams.get('page')) || 1;\n  // highlight-end\n \n  // highlight-start\n  const createPageURL = (pageNumber: number | string) => {\n    const params = new URLSearchParams(searchParams);\n    params.set('page', pageNumber.toString());\n    return `${pathname}?${params.toString()}`;\n  };\n  // highlight-end\n  // ...\n}\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"3",children:["\n",(0,t.jsx)(n.li,{children:"\u60f3\u8981\u6bcf\u6b21\u4f7f\u7528\u8005\u8f38\u5165\u65b0\u7684\u641c\u5c0b\u53c3\u6578\u90fd\u8b93\u5206\u9801\u5f9e\u4e00\u958b\u59cb\uff1a"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-tsx",metastring:"title='/app/ui/search.tsx'",children:"'use client';\n \nimport { MagnifyingGlassIcon } from '@heroicons/react/24/outline';\nimport { usePathname, useRouter, useSearchParams } from 'next/navigation';\nimport { useDebouncedCallback } from 'use-debounce';\n \nexport default function Search({ placeholder }: { placeholder: string }) {\n  const searchParams = useSearchParams();\n  const { replace } = useRouter();\n  const pathname = usePathname();\n \n  const handleSearch = useDebouncedCallback((term) => {\n    const params = new URLSearchParams(searchParams);\n    // highlight-next-line\n    params.set('page', '1');\n    if (term) {\n      params.set('query', term);\n    } else {\n      params.delete('query');\n    }\n    replace(`${pathname}?${params.toString()}`);\n  }, 300);\n}\n"})})]})}function d(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},11151:(e,n,a)=>{a.d(n,{Z:()=>c,a:()=>i});var t=a(67294);const r={},s=t.createContext(r);function i(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);