"use strict";(self.webpackChunkcode_fictionist=self.webpackChunkcode_fictionist||[]).push([[3999],{20001:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>c,contentTitle:()=>s,default:()=>m,frontMatter:()=>r,metadata:()=>o,toc:()=>d});var i=t(85893),a=t(11151);const r={title:"\u5b98\u65b9\u6559\u5b78 - \u8cc7\u6599\u8b8a\u66f4",tags:["react","next","crud"]},s=void 0,o={id:"framework/React/next-mutating-data",title:"\u5b98\u65b9\u6559\u5b78 - \u8cc7\u6599\u8b8a\u66f4",description:"Server Actions",source:"@site/docs/framework/React/09-next-mutating-data.mdx",sourceDirName:"framework/React",slug:"/framework/React/next-mutating-data",permalink:"/docs/framework/React/next-mutating-data",draft:!1,unlisted:!1,tags:[{label:"react",permalink:"/docs/tags/react"},{label:"next",permalink:"/docs/tags/next"},{label:"crud",permalink:"/docs/tags/crud"}],version:"current",sidebarPosition:9,frontMatter:{title:"\u5b98\u65b9\u6559\u5b78 - \u8cc7\u6599\u8b8a\u66f4",tags:["react","next","crud"]},sidebar:"programSidebar",previous:{title:"\u5b98\u65b9\u6559\u5b78 - \u641c\u5c0b\u8207\u5206\u9801",permalink:"/docs/framework/React/next-search"},next:{title:"\u5b98\u65b9\u6559\u5b78 - \u932f\u8aa4\u8655\u7406",permalink:"/docs/framework/React/next-error-handle"}},c={},d=[{value:"Server Actions",id:"server-actions",level:2},{value:"Creating an invoice",id:"creating-an-invoice",level:2},{value:"\u65b0\u589e\u4e00\u500b\u65b0\u7684\u8def\u7531\u548c\u8868\u683c",id:"\u65b0\u589e\u4e00\u500b\u65b0\u7684\u8def\u7531\u548c\u8868\u683c",level:3},{value:"\u5efa\u7acb Server Action",id:"\u5efa\u7acb-server-action",level:3},{value:"\u6293\u53d6 formData \u4e2d\u7684\u8cc7\u6599",id:"\u6293\u53d6-formdata-\u4e2d\u7684\u8cc7\u6599",level:3},{value:"\u9a57\u8b49\u8cc7\u6599",id:"\u9a57\u8b49\u8cc7\u6599",level:3},{value:"\u628a\u8cc7\u6599\u653e\u9032\u8cc7\u6599\u5eab",id:"\u628a\u8cc7\u6599\u653e\u9032\u8cc7\u6599\u5eab",level:3},{value:"Revalidate and redirect",id:"revalidate-and-redirect",level:3},{value:"Updating an invoice",id:"updating-an-invoice",level:2},{value:"\u5efa\u7acb\u52d5\u614b\u8def\u7531",id:"\u5efa\u7acb\u52d5\u614b\u8def\u7531",level:3},{value:"\u5f9e\u9801\u9762\u53c3\u6578\u8b80\u53d6 invoice <code>id</code>",id:"\u5f9e\u9801\u9762\u53c3\u6578\u8b80\u53d6-invoice-id",level:3},{value:"\u5f9e <code>id</code> \u6293\u53d6\u7279\u5b9a invoice",id:"\u5f9e-id-\u6293\u53d6\u7279\u5b9a-invoice",level:3},{value:"\u628a <code>id</code> \u50b3\u7d66 server action",id:"\u628a-id-\u50b3\u7d66-server-action",level:3},{value:"Deleting an invoice",id:"deleting-an-invoice",level:2}];function l(n){const e={admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,a.a)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h2,{id:"server-actions",children:"Server Actions"}),"\n",(0,i.jsx)(e.p,{children:"React Server Actions \u5141\u8a31\u5728 server \u4e0a\u57f7\u884c\u975e\u540c\u6b65\u7a0b\u5f0f\u78bc\uff0c\u9019\u6a23\u505a\u6709\u5e7e\u500b\u597d\u8655\uff1a"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u6027\u80fd\u63d0\u5347\uff1a\u901a\u904e\u5c07\u8cc7\u6599\u8655\u7406\u548c\u64cd\u4f5c\u4fdd\u7559\u5728\u4f3a\u670d\u5668\u4e0a\uff0c\u53ef\u4ee5\u6e1b\u5c11\u5ba2\u6236\u7aef\u9700\u8981\u57f7\u884c\u7684\u5de5\u4f5c\u91cf\uff0c\u5f9e\u800c\u6539\u5584\u61c9\u7528\u7684\u6574\u9ad4\u6027\u80fd\u548c\u97ff\u61c9\u901f\u5ea6\u3002"}),"\n",(0,i.jsx)(e.li,{children:"\u5b89\u5168\u6027\u52a0\u5f37\uff1a\u7531\u65bc\u64cd\u4f5c\u5728\u4f3a\u670d\u5668\u4e0a\u9032\u884c\uff0c\u9019\u6709\u52a9\u65bc\u66f4\u597d\u5730\u63a7\u5236\u5b89\u5168\u6027\u548c\u8a2a\u554f\u6b0a\u9650\u3002\u4f3a\u670d\u5668\u53ef\u4ee5\u9032\u884c\u5fb9\u5e95\u7684\u8eab\u4efd\u9a57\u8b49\u548c\u6388\u6b0a\u6aa2\u67e5\uff0c\u4e26\u4e14\u66f4\u5bb9\u6613\u9632\u6b62\u6f5b\u5728\u7684\u5b89\u5168\u6f0f\u6d1e\u3002"}),"\n",(0,i.jsx)(e.li,{children:"\u6578\u64da\u8655\u7406\u7684\u96c6\u4e2d\u5316\uff1a\u4f3a\u670d\u5668\u64cd\u4f5c\u4f7f\u5f97\u6578\u64da\u8655\u7406\u908f\u8f2f\u53ef\u4ee5\u96c6\u4e2d\u5728\u4f3a\u670d\u5668\u7aef\uff0c\u4fbf\u65bc\u7ba1\u7406\u548c\u7dad\u8b77\u3002\u9019\u5c0d\u65bc\u9700\u8981\u8207\u5f8c\u7aef\u6578\u64da\u5eab\u6216\u5176\u4ed6\u670d\u52d9\u4ea4\u4e92\u7684\u8907\u96dc\u61c9\u7528\u5c24\u5176\u6709\u76ca\u3002"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",metastring:"title='\u5b98\u65b9\u7bc4\u4f8b'",children:'// Server Component\nexport default function Page() {\n  // Action\n  async function create(formData: FormData) {\n    "use server";\n\n    // Logic to mutate data...\n  }\n  //  highlight-start\n  // Invoke the action using the "action" attribute\n  return <form action={create}>...</form>;\n  //   highlight-end\n}\n'})}),"\n",(0,i.jsx)(e.h2,{id:"creating-an-invoice",children:"Creating an invoice"}),"\n",(0,i.jsx)(e.h3,{id:"\u65b0\u589e\u4e00\u500b\u65b0\u7684\u8def\u7531\u548c\u8868\u683c",children:"\u65b0\u589e\u4e00\u500b\u65b0\u7684\u8def\u7531\u548c\u8868\u683c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"---| invoices/\n------| create/\n---------| page.tsx\n"})}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",metastring:"title='/dashboard/invoices/create/page.tsx'",children:'import Form from "@/app/ui/invoices/create-form";\nimport Breadcrumbs from "@/app/ui/invoices/breadcrumbs";\nimport { fetchCustomers } from "@/app/lib/data";\n\nexport default async function Page() {\n  const customers = await fetchCustomers();\n\n  return (\n    <main>\n      <Breadcrumbs\n        breadcrumbs={[\n          { label: "Invoices", href: "/dashboard/invoices" },\n          {\n            label: "Create Invoice",\n            href: "/dashboard/invoices/create",\n            active: true,\n          },\n        ]}\n      />\n      <Form customers={customers} />\n    </main>\n  );\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\u5efa\u7acb-server-action",children:"\u5efa\u7acb Server Action"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u5b9a\u7fa9 server function"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",metastring:"title='/app/lib/actions.ts'",children:'// mark all the exported functions within the file as server functions\n"use server";\n\nexport async function createInvoice(formData: FormData) {}\n'})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:"\u5728\u5143\u4ef6\u4e2d\u5f15\u7528\u6210 server action"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",metastring:"title='/app/ui/invoices/create-form.tsx'",children:"import { customerField } from '@/app/lib/definitions';\nimport Link from 'next/link';\nimport {\n  CheckIcon,\n  ClockIcon,\n  CurrencyDollarIcon,\n  UserCircleIcon,\n} from '@heroicons/react/24/outline';\nimport { Button } from '@/app/ui/button';\n// highlight-next-line\nimport { createInvoice } from '@/app/lib/actions';\n\nexport default function Form({\n  customers,\n}: {\n  customers: customerField[];\n}) {\n  return (\n    // highlight-next-line\n    <form action={createInvoice}>\n      // ...\n  )\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u6293\u53d6-formdata-\u4e2d\u7684\u8cc7\u6599",children:"\u6293\u53d6 formData \u4e2d\u7684\u8cc7\u6599"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",metastring:"title='/app/lib/actions.ts'",children:'"use server";\n\nexport async function createInvoice(formData: FormData) {\n  const rawFormData = {\n    customerId: formData.get("customerId"),\n    amount: formData.get("amount"),\n    status: formData.get("status"),\n  };\n  // Test it out:\n  console.log(rawFormData);\n}\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\u9a57\u8b49\u8cc7\u6599",children:"\u9a57\u8b49\u8cc7\u6599"}),"\n",(0,i.jsxs)(e.p,{children:["\u518d\u628a\u8cc7\u6599\u9001\u53bb\u8cc7\u6599\u5eab\u524d\u901a\u5e38\u9700\u8981\u5148\u9a57\u8b49\u8cc7\u6599\u683c\u5f0f\u3002",(0,i.jsx)(e.br,{}),"\n","\u4ee5\u4e0b\u662f invoices table \u9700\u6c42\u7684\u8cc7\u6599\u683c\u5f0f\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",metastring:"title='/app/lib/definitions.ts'",children:"export type Invoice = {\n  id: string; // Will be created on the database\n  customer_id: string;\n  amount: number; // Stored in cents\n  status: 'pending' | 'paid';\n  date: string;\n};\n"})}),"\n",(0,i.jsxs)(e.p,{children:["\u5728 Next \u4e2d\uff0c\u53ef\u4ee5\u5b89\u88dd\u5957\u4ef6 ",(0,i.jsx)(e.strong,{children:"Zod"})," \u4f86\u5e6b\u52a9\u9a57\u8b49\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",metastring:"title='/app/lib/actions.ts'",children:"'use server';\n\n// highlight-next-line\nimport { z } from 'zod';\n \n// highlight-start\nconst FormSchema = z.object({\n  id: z.string(),\n  customerId: z.string(),\n  amount: z.coerce.number(),\n  status: z.enum(['pending', 'paid']),\n  date: z.string(),\n});\n// highlight-end\n\n// highlight-next-line\nconst CreateInvoice = FormSchema.omit({ id: true, date: true });\n \nexport async function createInvoice(formData: FormData) {\n  // highlight-next-line\n  const { customerId, amount, status } = CreateInvoice.parse({\n    customerId: formData.get('customerId'),\n    amount: formData.get('amount'),\n    status: formData.get('status'),\n  });\n  const amountInCents = amount * 100;\n  const date = new Date().toISOString().split('T')[0];\n}\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u628a\u8cc7\u6599\u653e\u9032\u8cc7\u6599\u5eab",children:"\u628a\u8cc7\u6599\u653e\u9032\u8cc7\u6599\u5eab"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",metastring:"title='/app/lib/actions.ts'",children:"import { z } from 'zod';\n// highlight-next-line\nimport { sql } from '@vercel/postgres';\n \n// ...\n \nexport async function createInvoice(formData: FormData) {\n  const { customerId, amount, status } = CreateInvoice.parse({\n    customerId: formData.get('customerId'),\n    amount: formData.get('amount'),\n    status: formData.get('status'),\n  });\n  const amountInCents = amount * 100;\n  const date = new Date().toISOString().split('T')[0];\n \n//  highlight-start\n  await sql`\n    INSERT INTO invoices (customer_id, amount, status, date)\n    VALUES (${customerId}, ${amountInCents}, ${status}, ${date})\n  `;\n// highlight-end\n}\n"})}),"\n",(0,i.jsx)(e.admonition,{type:"warning",children:(0,i.jsxs)(e.p,{children:["\u9019\u4e00\u6b65\u505a\u5b8c\u6709\u932f\u8aa4\u51fa\u73fe\u662f\u6b63\u5e38\u7684\uff0c\u5b98\u65b9\u6559\u5b78\u5728\u4e0b\u4e00\u5f35\u624d\u662f\u505a\u932f\u8aa4\u8655\u7406\u3002",(0,i.jsx)(e.br,{}),"\n","\u9019\u88e1\u5148\u628a revalidate and redirect \u505a\u5b8c\u5c31\u4e0d\u6703\u6709\u932f\u8aa4\u4e86\u3002"]})}),"\n",(0,i.jsx)(e.h3,{id:"revalidate-and-redirect",children:"Revalidate and redirect"}),"\n",(0,i.jsx)(e.p,{children:"\u56e0\u70ba\u73fe\u5728\u65b0\u589e\u4e86\u4e00\u7b46\u8cc7\u6599\uff0c\u901a\u5e38\u6703\u5e0c\u671b\u6e32\u67d3\u4e5f\u8ddf\u8457\u8b8a\u52d5\uff0c\u6240\u4ee5\u6703\u9700\u8981\u6e05\u9664 client-side router \u7684\u7de9\u5b58\uff0c\u91cd\u65b0\u5f9e\u4f3a\u670d\u5668\u6293\u8cc7\u6599\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",metastring:"title='/app/lib/actions.ts'",children:"'use server';\n \nimport { z } from 'zod';\nimport { sql } from '@vercel/postgres';\n// highlight-start\nimport { revalidatePath } from 'next/cache';\nimport { redirect } from 'next/navigation';\n// highlight-end\n// ...\n \nexport async function createInvoice(formData: FormData) {\n  const { customerId, amount, status } = CreateInvoice.parse({\n    customerId: formData.get('customerId'),\n    amount: formData.get('amount'),\n    status: formData.get('status'),\n  });\n  const amountInCents = amount * 100;\n  const date = new Date().toISOString().split('T')[0];\n \n  await sql`\n    INSERT INTO invoices (customer_id, amount, status, date)\n    VALUES (${customerId}, ${amountInCents}, ${status}, ${date})\n  `;\n \n//  highlight-start\n  revalidatePath('/dashboard/invoices');\n  redirect('/dashboard/invoices');\n//   highlight-end\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"updating-an-invoice",children:"Updating an invoice"}),"\n",(0,i.jsxs)(e.p,{children:["\u5982\u679c\u9700\u6c42\u662f\u66f4\u65b0 invoices\uff0c\u6703\u9700\u8981\u50b3\u9001 invoices \u7684 ",(0,i.jsx)(e.code,{children:"id"})," \u81f3\u8cc7\u6599\u5eab\u624d\u80fd\u505a\u66f4\u65b0\uff0c\u6240\u4ee5\u9019\u6bb5\u7684\u91cd\u9ede\u5728\u5982\u4f55\u6293 ",(0,i.jsx)(e.code,{children:"id"}),"\u3002"]}),"\n",(0,i.jsx)(e.h3,{id:"\u5efa\u7acb\u52d5\u614b\u8def\u7531",children:"\u5efa\u7acb\u52d5\u614b\u8def\u7531"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u5148\u5efa\u7acb\u5982\u4e0b\u7684\u8cc7\u6599\u593e\u683c\u5f0f\uff1a"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-xml",children:"---| invoices\n------| [id]\n---------| edit\n------------| page.tsx\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsxs)(e.li,{children:["\u89c0\u5bdf\u5230 ",(0,i.jsx)(e.code,{children:"<Table>"})," \u5143\u4ef6\u4e2d\u6709\u4e00\u500b ",(0,i.jsx)(e.code,{children:"<UpdateInvoice />"})," \u5143\u4ef6\u5728\u63a5\u6536 invoices \u7684 ",(0,i.jsx)(e.code,{children:"id"}),"\uff1a"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",metastring:"title='/app/ui/invoices/table.tsx'",children:'export default async function InvoicesTable({\n  query,\n  currentPage,\n}: {\n  query: string;\n  currentPage: number;\n}) {\n  return (\n    // ...\n    <td className="flex justify-end gap-2 whitespace-nowrap px-6 py-4 text-sm">\n        {/* highlight-start */}\n      <UpdateInvoice id={invoice.id} />\n      <DeleteInvoice id={invoice.id} />\n      {/* highlight-end */}\n    </td>\n    // ...\n  );\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u6240\u4ee5\u63a5\u4e0b\u4f86\u524d\u5f80 ",(0,i.jsx)(e.code,{children:"<UpdateInvoice />"})," \u5143\u4ef6\u505a\u66f4\u65b0\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",metastring:"title='/app/ui/invoices/buttons.tsx'",children:"import { PencilIcon, PlusIcon, TrashIcon } from '@heroicons/react/24/outline';\nimport Link from 'next/link';\n \n// ...\n \nexport function UpdateInvoice({ id }: { id: string }) {\n  return (\n    <Link\n    {/* highlight-next-line */}\n      href={`/dashboard/invoices/${id}/edit`}\n      className=\"rounded-md border p-2 hover:bg-gray-100\"\n    >\n      <PencilIcon className=\"w-5\" />\n    </Link>\n  );\n}\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"\u5f9e\u9801\u9762\u53c3\u6578\u8b80\u53d6-invoice-id",children:["\u5f9e\u9801\u9762\u53c3\u6578\u8b80\u53d6 invoice ",(0,i.jsx)(e.code,{children:"id"})]}),"\n",(0,i.jsxs)(e.p,{children:["\u56de\u5230 ",(0,i.jsx)(e.code,{children:"<Page>"})," \u5143\u4ef6\uff0c\u8cbc\u4e0a\u4ee5\u4e0b code \u4f5c\u70ba\u8d77\u624b\u5f0f\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",metastring:"title='/app/dashboard/invoices/[id]/edit/page.tsx'",children:"import Form from '@/app/ui/invoices/edit-form';\nimport Breadcrumbs from '@/app/ui/invoices/breadcrumbs';\nimport { fetchCustomers } from '@/app/lib/data';\n \nexport default async function Page({ params }: { params: { id: string } }) {\n  const id = params.id;\n  return (\n    <main>\n      <Breadcrumbs\n        breadcrumbs={[\n          { label: 'Invoices', href: '/dashboard/invoices' },\n          {\n            label: 'Edit Invoice',\n            href: `/dashboard/invoices/${id}/edit`,\n            active: true,\n          },\n        ]}\n      />\n      <Form invoice={invoice} customers={customers} />\n    </main>\n  );\n}\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"\u5f9e-id-\u6293\u53d6\u7279\u5b9a-invoice",children:["\u5f9e ",(0,i.jsx)(e.code,{children:"id"})," \u6293\u53d6\u7279\u5b9a invoice"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",metastring:"title='/app/dashboard/invoices/[id]/edit/page.tsx'",children:"import Form from '@/app/ui/invoices/edit-form';\nimport Breadcrumbs from '@/app/ui/invoices/breadcrumbs';\n// highlight-next-line\nimport { fetchInvoiceById, fetchCustomers } from '@/app/lib/data';\n \nexport default async function Page({ params }: { params: { id: string } }) {\n  const id = params.id;\n//   highlight-start\n  const [invoice, customers] = await Promise.all([\n    fetchInvoiceById(id),\n    fetchCustomers(),\n  ]);\n//   highlight-end\n  // ...\n}\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"\u628a-id-\u50b3\u7d66-server-action",children:["\u628a ",(0,i.jsx)(e.code,{children:"id"})," \u50b3\u7d66 server action"]}),"\n",(0,i.jsxs)(e.admonition,{type:"warning",children:[(0,i.jsxs)(e.p,{children:["\u4e0d\u53ef\u628a ",(0,i.jsx)(e.code,{children:"id"})," \u50cf\u9019\u6a23\u50b3\u5165\uff1a"]}),(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",metastring:"title='/app/ui/invoices/edit-form.tsx'",children:"// Passing an id as argument won't work\n<form action={updateInvoice(id)}>\n"})})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",metastring:"title='/app/ui/invoices/edit-form.tsx'",children:'// ...\n// highlight-next-line\nimport { updateInvoice } from \'@/app/lib/actions\';\n \nexport default function EditInvoiceForm({\n  invoice,\n  customers,\n}: {\n  invoice: InvoiceForm;\n  customers: CustomerField[];\n}) {\n    // highlight-next-line\n  const updateInvoiceWithId = updateInvoice.bind(null, invoice.id);\n \n  return (\n    // highlight-next-line\n    <form action={updateInvoiceWithId}>\n      <input type="hidden" name="id" value={invoice.id} />\n    </form>\n  );\n}\n'})}),"\n",(0,i.jsxs)(e.p,{children:["\u63a5\u8457\u5230 ",(0,i.jsx)(e.strong,{children:"action.ts"})," \u5efa\u7acb\u4e00\u500b\u65b0\u7684 action - ",(0,i.jsx)(e.strong,{children:"updateInvoice"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",metastring:"title='/app/lib/actions.ts'",children:"// Use Zod to update the expected types\nconst UpdateInvoice = FormSchema.omit({ id: true, date: true });\n \n// ...\n \nexport async function updateInvoice(id: string, formData: FormData) {\n  const { customerId, amount, status } = UpdateInvoice.parse({\n    customerId: formData.get('customerId'),\n    amount: formData.get('amount'),\n    status: formData.get('status'),\n  });\n \n  const amountInCents = amount * 100;\n \n  await sql`\n    UPDATE invoices\n    SET customer_id = ${customerId}, amount = ${amountInCents}, status = ${status}\n    WHERE id = ${id}\n  `;\n \n  revalidatePath('/dashboard/invoices');\n  redirect('/dashboard/invoices');\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"deleting-an-invoice",children:"Deleting an invoice"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u4f7f\u7528 ",(0,i.jsx)(e.code,{children:"bind"})," \u628a id \u50b3\u7d66\u522a\u9664 action\uff1a"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-tsx",metastring:"title='/app/ui/invoices/buttons.tsx'",children:'// highlight-next-line\nimport { deleteInvoice } from \'@/app/lib/actions\';\n \n// ...\n\n// highlight-start\nexport function DeleteInvoice({ id }: { id: string }) {\n  const deleteInvoiceWithId = deleteInvoice.bind(null, id);\n// highlight-end\n \n  return (\n    // highlight-next-line\n    <form action={deleteInvoiceWithId}>\n      <button className="rounded-md border p-2 hover:bg-gray-100">\n        <span className="sr-only">Delete</span>\n        <TrashIcon className="w-4" />\n      </button>\n    {/* highlight-next-line */}\n    </form>\n  );\n}\n'})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsxs)(e.li,{children:["\u63a5\u8457\u5230 ",(0,i.jsx)(e.strong,{children:"action.ts"})," \u5efa\u7acb\u4e00\u500b\u65b0\u7684 action - ",(0,i.jsx)(e.strong,{children:"deleteInvoice"}),"\uff1a"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-ts",metastring:"title='/app/lib/actions.ts'",children:"export async function deleteInvoice(id: string) {\n  await sql`DELETE FROM invoices WHERE id = ${id}`;\n  revalidatePath('/dashboard/invoices');\n}\n"})})]})}function m(n={}){const{wrapper:e}={...(0,a.a)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(l,{...n})}):l(n)}},11151:(n,e,t)=>{t.d(e,{Z:()=>o,a:()=>s});var i=t(67294);const a={},r=i.createContext(a);function s(n){const e=i.useContext(r);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:s(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);